"use strict";var confirmBox,dot,btIcon,markingItems,messages,currentPage={student:0,lecturer:0},markingComplete=!1,markingOpen=!1,markingStep=1,fetchSignal=null,signInsDone=!1,signals={bluetooth:!1,wifi:!1};function getApp(e){return!(!e||"BODY"===e.tagName)&&("phone-viewport"===e.className?e.dataset.app:getApp(e.parentElement))}function setPage(e,t){const n="object"==typeof e?getApp(e):e;!n||t<1||(currentPage[n]=t,document.querySelector(`.phone-viewport[data-app="${n}"]`).firstElementChild.style.marginLeft=`calc(-292px * ${t-1})`,tooltipPage(n,t))}function getPage(e){return currentPage[e]}function showBanner(e){const t=document.querySelector(".attendance-status i"),n=document.getElementsByClassName("attendance-banner")[0],s=document.getElementsByClassName("attendance-messages")[0];switch(t.classList.remove("pulse"),e){case"bluetooth":t.classList.add("bad"),n.classList.add("bad"),n.querySelector(".bluetooth").setAttribute("rel","visible"),s.classList.add("bad");break;case"wifi":t.classList.add("warn"),n.classList.add("warn"),n.querySelector(".wifi").setAttribute("rel","visible");break;case"done":t.classList.add("done"),n.classList.add("done"),n.querySelector(".done").setAttribute("rel","visible")}document.getElementsByClassName("attendance-banner")[0].setAttribute("rel","show")}function closeBanner(){document.querySelector(".attendance-status i").className="fab fa-bluetooth-b",document.getElementsByClassName("attendance-messages")[0].className="attendance-messages";const e=document.getElementsByClassName("attendance-banner")[0];e.className="attendance-banner",e.querySelector("[rel]").removeAttribute("rel")}function resume(e){switch(closeBanner(),e|=markingStep){case 1:listenForSignal();break;case 2:collectData();break;case 3:sendAttendance()}}function toggleConnection(e){signals[e]?signals[e]=!1:signals[e]=!0,signals[e]&&3===getPage("student")&&("bluetooth"===e&&markingStep<3?resume():"wifi"===e&&markingStep>1&&resume())}function selectTab(e,t){document.querySelector(".tabs-option[rel]").removeAttribute("rel"),e.setAttribute("rel","selected"),document.querySelector(".tabs-screen[rel]").removeAttribute("rel"),document.querySelector(`.tabs-screen[data-tab="${t}"]`).setAttribute("rel","visible")}function blinkMarkingArrow(){const e=document.getElementsByClassName("marking-arrow")[0];e.classList.add("active"),setTimeout(()=>{e.classList.remove("active")},4500)}function sendAttendance(){markingStep=3,setTimeout(()=>{if(!signals.bluetooth)return showBanner("bluetooth");sendSignal(),setTimeout(()=>{messages[2].classList.replace("active","done"),messages[2].firstElementChild.checked=!0,signAttendance(),blinkMarkingArrow()},1800)},1e3)}function collectData(){markingStep=2,messages[0].classList.replace("active","done"),messages[0].firstElementChild.checked=!0,messages[1].classList.add("active"),document.querySelector(".attendance-status i").classList.remove("pulse"),returnSignal();let e=2e3*Math.random()+2e3;setTimeout(()=>signals.bluetooth?signals.wifi?(sendAttendance(),messages[1].classList.replace("active","done"),messages[1].firstElementChild.checked=!0,void messages[2].classList.add("active")):showBanner("wifi"):showBanner("bluetooth"),e)}function listenForSignal(){markingStep=1,markingComplete||(messages[0].classList.add("active"),sendSignal(),fetchSignal=setInterval(function(){signals.bluetooth?markingOpen?(clearInterval(fetchSignal),collectData()):sendSignal():(clearInterval(fetchSignal),showBanner("bluetooth"))},2e3))}function stopListening(){setPage("student",2),clearInterval(fetchSignal)}function fillUser(){const e=document.getElementsByName("username")[0].value;document.getElementById("username").innerHTML=e,document.getElementById("student-number").innerHTML=Math.floor(1e5+9e5*Math.random())}function closeBox(){confirmBox.removeAttribute("rel"),confirmBox.getElementsByTagName("button")[0].removeAttribute("data-n")}function openConfirm(e){confirmBox.setAttribute("rel","visible"),confirmBox.getElementsByTagName("button")[0].dataset.n=e}function markStudent(e){"string"==typeof e?(document.querySelectorAll(".signal .attendee")[+e].click(),closeBox()):e.screenY?(openConfirm(this._count),e.preventDefault()):markingItems[this._count].click()}function sendSignal(){let e=0,t=0,n=setInterval(function(){e<=140?t+=.01:e>=140&&(t-=.01);100===e?btIcon.style.color="#4794eb":180===e&&btIcon.removeAttribute("style");276===e&&clearInterval(n);e++,dot.style.left=e+"px",dot.style.opacity=t},5)}function returnSignal(){let e=276,t=0,n=setInterval(function(){e>=140?t+=.01:e<=140&&(t-=.01);0===e&&clearInterval(n);e--,dot.style.left=e+"px",dot.style.opacity=t},5)}function loadAttendees(){setPage("lecturer",3);for(let e=0;e<markingItems.length;++e)markingItems[e].style.opacity="0",setTimeout(()=>{markingItems[e].removeAttribute("style")},250*(e+1))}function simulateSignIns(){if(setPage("lecturer",4),signInsDone)return;signInsDone=!0;const e=document.querySelectorAll(".signal .attendee input");let t=0;for(let n=0;n<e.length-2;++n)t=Math.random()*n*500+500,setTimeout(()=>{e[n].click()},t)}function openMarking(){simulateSignIns(),markingOpen=!0}function signAttendance(){let e=document.querySelectorAll(".signal .attendee input");e[e.length-2].click(),markingComplete=!0,showBanner("done")}function validateSignin(e){e.preventDefault();const t=new FormData(this),n=this.nextElementSibling;n.removeAttribute("rel");for(let e of t.entries())if(!e[1])return n.innerText=`The ${e[0]} cannot be blank.`,void n.setAttribute("rel","visible");closeTooltip(),fillUser(),setPage(this,2)}function dragStyle(){this.classList.toggle("dragging")}function changeImage(e,t){const n=URL.createObjectURL(t);e.onload=function(){URL.revokeObjectURL(n)},e.classList.remove("dragging"),e.style.backgroundImage=`url(${n})`,e.innerText=""}function fileDrop(e){e.preventDefault(),changeImage(this,e.dataTransfer.files[0])}function fileClick(){const e=this.nextElementSibling;e.onchange=(e=>{changeImage(this,e.target.files[0])}),e.click()}function tooltipPage(e,t){let n=document.querySelector(`.tooltip-app[data-app="${e}"]`).children;for(let e of n)+e.dataset.page===t?e.setAttribute("rel","visible"):e.removeAttribute("rel")}function closeTooltip(){closeTooltip._s&&(closeTooltip._s.classList.remove("active"),closeTooltip._s=null,document.getElementsByClassName("walkthrough-overlay")[0].removeAttribute("rel"),document.getElementsByClassName("walkthrough-active")[0].classList.remove("walkthrough-active"),window.removeEventListener("click",closeTooltip,!0))}function checkTooltip(e){e.target&&e.target.classList.contains("walkthrough-overlay")&&closeTooltip()}function openTooltip(){this.classList.add("active"),document.getElementsByClassName("walkthrough-overlay")[0].setAttribute("rel","visible"),document.querySelector(`[data-tooltip="${this.dataset.for}"]`).classList.add("walkthrough-active"),closeTooltip._s=this,window.addEventListener("click",checkTooltip,!0)}window.addEventListener("DOMContentLoaded",e=>{markingItems=document.querySelectorAll(".marking .attendee"),messages=document.getElementsByClassName("message"),confirmBox=document.getElementsByClassName("marking-confirm")[0],dot=document.getElementsByClassName("phone-signal-dot")[0],btIcon=document.querySelector(".phone-signal i");const t=document.querySelectorAll(".signal .attendee input");let n,s=0;for(n of t)n._count=s,n.onclick=markStudent,s++;for(let e of document.getElementsByClassName("phone-form"))e.onsubmit=validateSignin;const a=document.getElementById("dnd-logo");a.addEventListener("dragenter",dragStyle,!1),a.addEventListener("dragleave",dragStyle,!1),a.addEventListener("drop",fileDrop,!1),a.addEventListener("click",fileClick,!1),a.addEventListener("dragover",e=>e.preventDefault(),!1);const o=document.getElementsByClassName("tooltip-indicator");for(let e of o)e.onclick=openTooltip});